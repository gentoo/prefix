--- configure.in.old	2008-07-04 17:51:51.000000000 +0200
+++ configure.in	2008-07-04 18:00:12.000000000 +0200
@@ -255,16 +255,26 @@
 
 dnl exempi checking
 
-PKG_CHECK_MODULES(EXEMPI, exempi-2.0 >= exempi_minver, [
-		  AM_CONDITIONAL(HAVE_EXEMPI, true)
-		  AC_DEFINE(HAVE_EXEMPI, 1, [Define to enable XMP support])
-		  ], [AM_CONDITIONAL(HAVE_EXEMPI, false)])
+AM_CONDITIONAL(HAVE_EXEMPI, false)
 
-PKG_CHECK_MODULES(EXEMPI_NEW_API, exempi-2.0 >= exempi_minver_newapi,
+AC_ARG_ENABLE(xmp, 
+	AC_HELP_STRING([--disable-xmp], 
+			[build without xmp support]))
+msg_xmp=no
+if test "x$enable_xmp" != "xno"; then
+	PKG_CHECK_MODULES(EXEMPI, exempi-2.0 >= exempi_minver, [
+		  	  AM_CONDITIONAL(HAVE_EXEMPI, true)
+			  AC_DEFINE(HAVE_EXEMPI, 1, [Define to enable xmp support])
+			  ]
+                          msg_xmp=yes,
+	          	  [AM_CONDITIONAL(HAVE_EXEMPI, false)])
+
+	PKG_CHECK_MODULES(EXEMPI_NEW_API, exempi-2.0 >= exempi_minver_newapi,
 		  AC_DEFINE(HAVE_EXEMPI_NEW_API, 1, [Define if we have exempi with the new API]), true)
 
-AC_SUBST(EXEMPI_CFLAGS)
-AC_SUBST(EXEMPI_LIBS)
+	AC_SUBST(EXEMPI_CFLAGS)
+	AC_SUBST(EXEMPI_LIBS)
+fi
 
 dnl ==========================================================================
 dnl search implementations
